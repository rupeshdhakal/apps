<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Base64 Decoder</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }

    h1 {
      color: #0078d7;
      margin-top: 40px;
      font-size: 2rem;
      text-align: center;
    }

    .container {
      background: #ffffff;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      padding: 25px;
      width: 90%;
      max-width: 600px;
      margin-top: 30px;
    }

    textarea {
      width: 100%;
      height: 140px;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      font-size: 1rem;
      resize: vertical;
      color: #333;
      background-color: #fff;
    }

    textarea::placeholder {
      color: #999;
    }

    .buttons {
      margin: 15px 0;
      text-align: center;
    }

    button {
      background-color: #0078d7;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 1rem;
      cursor: pointer;
      margin: 5px;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #005fa3;
    }

    button:active {
      background-color: #004b82;
    }

    footer {
      margin-top: 40px;
      font-size: 0.9rem;
      color: #777;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 1.6rem;
      }

      .container {
        padding: 15px;
      }
    }
  </style>
</head>
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>JWKS ? ClearKey Hex Converter</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 0 20px;
    }

    textarea {
      width: 100%;
      height: 150px;
      margin-bottom: 20px;
      font-family: monospace;
      font-size: 14px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
    }

    pre {
      font-size: 1rem;
      background: #f4f4f4;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
  </style>
</head>

<body>
  <h1>Base64 To ClearKey Converter</h1>
  <p>Paste your Base64-encoded string below:</p>
  <textarea id="base64Input" placeholder="Base64 here..."></textarea>
  <button onclick="convertJWKS()">Convert</button>

  <h2>ClearKey:</h2>
  <pre id="output"></pre>

  <script>
    function base64ToText(base64) {
      base64 = base64.replace(/-/g, '+').replace(/_/g, '/');
      while (base64.length % 4) base64 += '=';
      return atob(base64);
    }

    function base64UrlToHex(base64Url) {
      let base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      while (base64.length % 4) base64 += '=';
      const raw = atob(base64);
      return Array.from(raw)
        .map(ch => ch.charCodeAt(0).toString(16).padStart(2, '0'))
        .join('');
    }

    function jwksToClearKeyHex(jwks) {
      if (!jwks?.keys?.length) throw new Error("Invalid JWKS");
      return jwks.keys.map(k => `${base64UrlToHex(k.kid)}:${base64UrlToHex(k.k)}`);
    }

    function base64JwksToClearKeyHex(base64Jwks) {
      try {
        const jsonText = base64ToText(base64Jwks);
        const jwks = JSON.parse(jsonText);
        return jwksToClearKeyHex(jwks);
      } catch (err) {
        throw new Error("Failed to decode or parse JWKS: " + err.message);
      }
    }

    function convertJWKS() {
      const input = document.getElementById('base64Input').value.trim();
      const outputEl = document.getElementById('output');
      if (!input) {
        outputEl.textContent = "Please enter a Base64-encoded string.";
        return;
      }
      try {
        const result = base64JwksToClearKeyHex(input);
        outputEl.textContent = result.join('\n'); // each kid:k on a new line
      } catch (err) {
        outputEl.textContent = "Error: " + err.message;
      }
    }

    const outputEl = document.getElementById('output');

    outputEl.addEventListener('click', () => {
      const text = outputEl.textContent;
      if (!text) return;

      // Copy to clipboard
      navigator.clipboard.writeText(text).then(() => {
        // Show temporary indicator
        const originalBg = outputEl.style.backgroundColor;
        outputEl.style.backgroundColor = '#d4edda'; // green-ish
        outputEl.textContent = "Copied to clipboard!\n\n" + text;

        setTimeout(() => {
          outputEl.style.backgroundColor = originalBg;
          outputEl.textContent = text; // restore original text
        }, 1500);
      }).catch(err => {
        alert("Failed to copy: " + err);
      });
    });

  </script>

</body>

</html>

</html>